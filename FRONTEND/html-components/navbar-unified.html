<!-- FLUXI NAVBAR UNIFICADO - Usar en todas las vistas (excepto KYC) -->
<header class="fluxi-navbar">

  <!-- LEFT: Título de página (opcional) -->
  <div class="fluxi-navbar-left">
    <h1 class="fluxi-page-title" id="navbarPageTitle">Dashboard</h1>
  </div>

  <!-- CENTER: Logo -->
  <div class="fluxi-navbar-brand">
    <img src="assets/fluxi.png" class="fluxi-navbar-brand-logo" alt="FLUXI Logo" />
  </div>

  <!-- RIGHT: Notificaciones y Usuario -->
  <div class="fluxi-navbar-right">

    <!-- Notificaciones -->
    <div class="fluxi-notification-icon" id="navNotificationIcon">
      <i class="bx bx-bell"></i>
      <span class="fluxi-notification-badge" id="navNotificationBadge" style="display: none;">0</span>
    </div>

    <!-- Usuario -->
    <div class="fluxi-user" id="navUserButton">
      <img src="./assets/mascota.jpeg" alt="Avatar" class="fluxi-user-avatar" id="navUserAvatar" />
      <span class="fluxi-username" id="navUsername">Usuario</span>

      <!-- Dropdown menu (opcional) -->
      <div class="fluxi-user-menu" id="navUserMenu">
        <button class="fluxi-user-menu-item" onclick="navigateToProfile()">
          <i class="bx bx-user"></i>
          <span>Mi Perfil</span>
        </button>
        <button class="fluxi-user-menu-item" onclick="navigateToSettings()">
          <i class="bx bx-cog"></i>
          <span>Configuración</span>
        </button>
        <div class="fluxi-user-menu-divider"></div>
        <button class="fluxi-user-menu-item" onclick="logout()" style="color: #f5576c;">
          <i class="bx bx-log-out"></i>
          <span>Cerrar Sesión</span>
        </button>
      </div>
    </div>

  </div>

</header>

<script>
/**
 * Script para gestionar el navbar unificado
 * Incluye: usuario, notificaciones, dropdown menu, etc.
 */

// Actualizar nombre de usuario en el navbar
function updateNavbarUser() {
  const session = getSession();
  if (session?.user?.username) {
    const usernameEl = document.getElementById('navUsername');
    if (usernameEl) {
      usernameEl.textContent = session.user.username;
    }
  }
}

// Toggle del menu dropdown del usuario
document.addEventListener('DOMContentLoaded', () => {
  const navUserButton = document.getElementById('navUserButton');
  const navUserMenu = document.getElementById('navUserMenu');

  if (navUserButton && navUserMenu) {
    navUserButton.addEventListener('click', (e) => {
      e.stopPropagation();
      navUserButton.classList.toggle('active');
    });

    // Cerrar al hacer click fuera
    document.addEventListener('click', () => {
      navUserButton.classList.remove('active');
    });
  }

  // Actualizar usuario al cargar
  updateNavbarUser();
});

// Actualizar notificaciones
function updateNavbarNotifications(count = 0) {
  const badge = document.getElementById('navNotificationBadge');
  if (badge) {
    if (count > 0) {
      badge.textContent = count > 99 ? '99+' : count;
      badge.style.display = 'block';
    } else {
      badge.style.display = 'none';
    }
  }
}

// Navegar a perfil
function navigateToProfile() {
  window.location.href = './myaccount.html';
}

// Navegar a configuración
function navigateToSettings() {
  alert('Configuración disponible pronto');
}

// Logout
function logout() {
  if (confirm('¿Estás seguro de que deseas cerrar sesión?')) {
    localStorage.removeItem('fluxiSession');
    window.location.href = './login.html';
  }
}
</script>
